<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vines - Gaming Community</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a1f0f 0%, #1a3a1f 50%, #0f2615 100%);
            color: #e8f5e9;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Jungle vine decorations */
        .vine-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            opacity: 0.05;
            background-image: 
                repeating-linear-gradient(90deg, transparent, transparent 100px, #2e7d32 100px, #2e7d32 102px),
                repeating-linear-gradient(0deg, transparent, transparent 100px, #1b5e20 100px, #1b5e20 102px);
            pointer-events: none;
            z-index: 0;
        }

        header {
            background: rgba(13, 31, 18, 0.95);
            padding: 1.5rem 2rem;
            border-bottom: 3px solid #2e7d32;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(46, 125, 50, 0.3);
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: #66bb6a;
            text-shadow: 0 0 20px rgba(102, 187, 106, 0.5);
            letter-spacing: 3px;
        }

        .nav-links {
            display: flex;
            gap: 3rem;
            align-items: center;
        }

        .nav-links a {
            color: #a5d6a7;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            position: relative;
        }

        .nav-links a:hover {
            color: #66bb6a;
            background: rgba(46, 125, 50, 0.2);
            transform: translateY(-2px);
        }

        .discord-btn {
            background: white;
            color: #2e7d32;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 187, 106, 0.3);
        }

        .discord-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(102, 187, 106, 0.5);
            background: #f1f8f4;
        }

        .discord-icon {
            width: 28px;
            height: 28px;
        }

        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 4rem 2rem;
            position: relative;
            z-index: 1;
        }

        .hero {
            text-align: center;
            padding: 4rem 2rem;
            background: rgba(27, 94, 32, 0.3);
            border-radius: 20px;
            margin-bottom: 4rem;
            border: 2px solid #2e7d32;
            box-shadow: 0 8px 32px rgba(46, 125, 50, 0.2);
        }

        .hero h1 {
            font-size: 4rem;
            color: #66bb6a;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(102, 187, 106, 0.6);
        }

        .hero p {
            font-size: 1.5rem;
            color: #a5d6a7;
            max-width: 800px;
            margin: 0 auto;
        }

        .content-section {
            background: rgba(27, 94, 32, 0.2);
            padding: 3rem;
            border-radius: 20px;
            margin-bottom: 3rem;
            border: 2px solid #2e7d32;
            backdrop-filter: blur(10px);
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-section h2 {
            font-size: 2.5rem;
            color: #66bb6a;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 20px rgba(102, 187, 106, 0.4);
        }

        .content-section p {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #c8e6c9;
            margin-bottom: 1rem;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .game-card {
            background: rgba(13, 31, 18, 0.8);
            padding: 2rem;
            border-radius: 15px;
            border: 2px solid #2e7d32;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.2);
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 30px rgba(102, 187, 106, 0.4);
            border-color: #66bb6a;
        }

        .game-card h3 {
            color: #66bb6a;
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        footer {
            background: rgba(13, 31, 18, 0.95);
            padding: 2rem;
            text-align: center;
            border-top: 3px solid #2e7d32;
            margin-top: 4rem;
            position: relative;
            z-index: 1;
        }

        footer p {
            color: #a5d6a7;
            font-size: 1rem;
        }

        /* Fallout Game Overlay */
        #fallout-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000;
        }

        #fallout-overlay.active {
            display: block;
        }

        #fallout-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #66bb6a;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            z-index: 1001;
        }

        #fallout-close:hover {
            background: #4CAF50;
        }

        #fallout-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-family: monospace;
            font-size: 20px;
            color: #fedb1d;
        }

        #fallout-progress {
            margin-top: 20px;
            font-size: 16px;
        }

        #fallout-canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            width: auto;
            height: 100%;
            background: black;
            transform: translate(-50%, -50%);
            display: none;
        }

        /* Ragdoll Hit Overlay */
        #ragdoll-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000;
        }

        #ragdoll-overlay.active {
            display: block;
        }

        #ragdoll-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #66bb6a;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            z-index: 1001;
        }

        #ragdoll-close:hover {
            background: #4CAF50;
        }

        #ragdoll-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Ragdoll Archers Overlay */
        #archers-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000;
        }

        #archers-overlay.active {
            display: block;
        }

        #archers-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #66bb6a;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            z-index: 1001;
        }

        #archers-close:hover {
            background: #4CAF50;
        }

        #archers-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Flight Simulator Overlay */
        #flight-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000;
        }

        #flight-overlay.active {
            display: block;
        }

        #flight-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #66bb6a;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            z-index: 1001;
        }

        #flight-close:hover {
            background: #4CAF50;
        }

        #flight-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div class="vine-bg"></div>
    
    <header>
        <nav>
            <div class="logo">üåø VINES</div>
            <div class="nav-links">
                <a href="#" onclick="showSection('home')">Home</a>
                <a href="#" onclick="showSection('gaming')">Gaming</a>
                <a href="#" onclick="showSection('partners')">Partners</a>
                <a href="https://discord.gg/5GmrCaAN" target="_blank" class="discord-btn">
                    <svg class="discord-icon" viewBox="0 0 127.14 96.36" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#4CAF50" d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
                    </svg>
                    Join The Discord
                </a>
            </div>
        </nav>
    </header>

    <main>
        <div id="home" class="content-section active">
            <div class="hero">
                <h1>Welcome to Vines</h1>
            </div>
            
            <div style="text-align: center; padding: 2rem;">
                <h2 style="color: #66bb6a; font-size: 2rem; margin-bottom: 1rem;">Join Our Thriving Community</h2>
            </div>
        </div>

        <div id="gaming" class="content-section">
            <h2>üéÆ Gaming Hub</h2>
            <p>Explore our diverse gaming community across multiple titles and platforms. From competitive esports to casual co-op, there's something for every type of player.</p>
            
            <div class="game-grid">
                <div class="game-card" onclick="openRagdollHit()" style="cursor: pointer;">
                    <h3>üéØ Play Ragdoll Hit</h3>
                    <p>Launch ragdolls and watch the physics chaos unfold. Click to play now!</p>
                </div>
                <div class="game-card" onclick="openFlightSim()" style="cursor: pointer;">
                    <h3>‚úàÔ∏è Play Flight Simulator</h3>
                    <p>Take to the skies in this exciting flight simulation game. Click to play now!</p>
                </div>
                <div class="game-card">
                    <h3>üèÜ Competitive League</h3>
                    <p>Climb the ranks with our competitive squads. Team-based strategy games and ranked matches daily.</p>
                </div>
                <div class="game-card">
                    <h3>üé≤ Casual Corner</h3>
                    <p>Relax and have fun with party games, indie titles, and weekly game nights with the community.</p>
                </div>
                <div class="game-card" onclick="openFallout()" style="cursor: pointer;">
                    <h3>‚ò¢Ô∏è Play Fallout</h3>
                    <p>Experience the classic post-apocalyptic RPG right in your browser. Click to launch!</p>
                </div>
            </div>
        </div>

        <div id="partners" class="content-section">
            <h2>ü§ù Our Partners</h2>
            <p>Vines is proud to collaborate with amazing content creators, gaming organizations, and brands that share our passion for building great communities.</p>
            
            <div class="game-grid">
                <div class="game-card">
                    <h3>This could be your site</h3>
                    <p>Partner with us to reach our engaged gaming community and grow together.</p>
                </div>
                <div class="game-card">
                    <h3>This could be your site</h3>
                    <p>Join our partnership program and get featured here with exclusive benefits.</p>
                </div>
                <div class="game-card">
                    <h3>This could be your site</h3>
                    <p>Collaborate with Vines and connect with passionate gamers worldwide.</p>
                </div>
            </div>
            
            <div style="margin-top: 3rem; padding: 2rem; background: rgba(13, 31, 18, 0.6); border-radius: 15px; border: 2px solid #2e7d32;">
                <h3 style="color: #66bb6a; font-size: 2rem; margin-bottom: 1rem;">Interested in Partnering?</h3>
                <p style="color: #c8e6c9; font-size: 1.1rem;">We're always looking to collaborate with like-minded creators and organizations. Reach out on Discord to discuss partnership opportunities!</p>
            </div>
        </div>
    </main>

    <footer>
        <p>¬© 2024 Vines Gaming Community. All rights reserved. üåø</p>
    </footer>

    <!-- Fallout Game Overlay -->
    <div id="fallout-overlay">
        <button id="fallout-close" onclick="closeFallout()">‚úï Close Game</button>
        <div id="fallout-loading">
            <div>Loading Fallout...</div>
            <div id="fallout-progress">Merging archive parts: 0%</div>
        </div>
        <canvas id="fallout-canvas" onClick="window.focus();" />
    </div>

    <!-- Ragdoll Hit Game Overlay -->
    <div id="ragdoll-overlay">
        <button id="ragdoll-close" onclick="closeRagdollHit()">‚úï Close Game</button>
        <iframe id="ragdoll-frame"></iframe>
    </div>

    <!-- Ragdoll Archers Game Overlay -->
    <div id="archers-overlay">
        <button id="archers-close" onclick="closeRagdollArchers()">‚úï Close Game</button>
        <iframe id="archers-frame"></iframe>
    </div>

    <!-- Flight Simulator Game Overlay -->
    <div id="flight-overlay">
        <button id="flight-close" onclick="closeFlightSim()">‚úï Close Game</button>
        <iframe id="flight-frame"></iframe>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bubbls/dosbox/js/es6-promise.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bubbls/dosbox/js/browserfs.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bubbls/dosbox/js/loader.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

    <script>
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
        }

        function openFallout() {
            document.getElementById('fallout-overlay').classList.add('active');
            loadAndMergeZipParts();
        }

        function closeFallout() {
            document.getElementById('fallout-overlay').classList.remove('active');
            location.reload(); // Reload to reset the game
        }

        function openRagdollHit() {
            const overlay = document.getElementById('ragdoll-overlay');
            const iframe = document.getElementById('ragdoll-frame');
            
            // Create the game HTML content
            const gameHTML = `
<!DOCTYPE html>
<html lang="en-us">
<head>
    <base href="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@main/ragdoll-hit/">
    <meta name="robots" content="noindex,nofollow" />
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Ragdoll Hit</title>
    <script>
      window.fileMergerConfig = {
        files: [
          { name: '959bf1c60308f1c34bf072f43c3c17d4.data.unityweb', parts: 1 },
          { name: 'f23c0f3f40a28f1adce731399dde22aa.wasm.unityweb', parts: 2 },
          { name: '3276aa7c11496bcc48eb6908f112f0c3.js.unityweb', parts: 1 },
        ],
        basePath: 'Build/',
        debug: true
      };  
    <\/script>
    <script src="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@main/merge.js"><\/script>
    <script>
    window.config = {
        loader: 'unity-2020',
        debug: false,
        maxRatio: 24 / 9,
        minRatio: 9 / 24,
        title: 'Ragdoll Hit',
        thumbnail: 'thumbnail.png',
        numScreenshots: 4,
        unityVersion: '2022.3.6f1',
        unityWebglBuildUrl: '',
        fileSize: 9,
        cachedDecompressedFileSizes: {
            '3276aa7c11496bcc48eb6908f112f0c3.js.unityweb': 66682,
            '959bf1c60308f1c34bf072f43c3c17d4.data.unityweb': 4377721,
            'f23c0f3f40a28f1adce731399dde22aa.wasm.unityweb': 5105161,
            'v84.loader.js': 114199,
        },
        "metadata": {"poki_template_version":1,"background_color":"#4D4D4D","code_filename":"f23c0f3f40a28f1adce731399dde22aa.wasm.unityweb","company_name":"Ericetto","data_filename":"959bf1c60308f1c34bf072f43c3c17d4.data.unityweb","decompression_fallback":"Brotli","development_player":"false","framework_filename":"3276aa7c11496bcc48eb6908f112f0c3.js.unityweb","height":"600","loader_filename":"v84.loader.js","product_name":"Ragdoll Hit","product_version":"0.1","splash_screen_style":"Dark","unity_version":"2022.3.6f1","use_data_caching":"true","use_threads":"false","use_wasm":"true","use_webgl_1_0":"true","use_webgl_2_0":"true","width":"960"}
    };
    <\/script>
    <script src="MobileDetect.js"><\/script>
</head>
<body>
    <script src="master-loader.js"><\/script>
</body>
</html>
            `;
            
            iframe.srcdoc = gameHTML;
            overlay.classList.add('active');
        }

        function closeRagdollHit() {
            document.getElementById('ragdoll-overlay').classList.remove('active');
            document.getElementById('ragdoll-frame').srcdoc = '';
        }

        function openRagdollArchers() {
            const overlay = document.getElementById('archers-overlay');
            const iframe = document.getElementById('archers-frame');
            
            const gameHTML = `
<!DOCTYPE html>
<html lang="en-us">
<head>
    <script src="https://cdn.jsdelivr.net/gh/laparda14/Ragdoll-archers@62504c9570ea720c6367e7debe1e110c68f77c2d/vs/gameloader-helper.js"><\/script>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ragdoll Archers</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bubbls/ruffle@04dd5345a30d6ebf4b0e2cc385568750cd56ed5a/styyyle.css">
</head>
<body>
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas"></canvas>
    </div>
    <div id="loading-cover">
        <div id="unity-loading-bar">
            <div id="unity-logo"><img src="logo.jpeg"></div>
            <div class="progress-spinner-container">
                <div class="spinner-left"><img src="spinner.png"></div>
                <div id="unity-progress-bar-empty">
                    <div id="unity-progress-bar-full"></div>
                </div>
                <div class="spinner-right"><img src="spinner.png"></div>
            </div>
        </div>
    </div>
    <script>
        const buildUrl = "Build";
        const loaderUrl = "https://cdn.jsdelivr.net/gh/bubbls/ruffle@7117cc5006472d782b65d96abd375597d6273242/v11121212.js";
        const config = {
            dataUrl: "https://cdn.jsdelivr.net/gh/bubbls/ruffle@04dd5345a30d6ebf4b0e2cc385568750cd56ed5a/6697b6deba8b617c67b69c55dcd07cb1.data.unityweb",
            frameworkUrl: "https://cdn.jsdelivr.net/gh/bubbls/ruffle@04dd5345a30d6ebf4b0e2cc385568750cd56ed5a/0be3c3ee7115b26e1ae28e643afdf1f2.js.unityweb",
            codeUrl: "https://cdn.jsdelivr.net/gh/bubbls/ruffle@04dd5345a30d6ebf4b0e2cc385568750cd56ed5a/b3397c29f6878557c1c614cbf9e196ea.wasm.unityweb",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "Ericetto",
            productName: "Ragdoll Archers",
            productVersion: "0.1",
        };

        const container = document.querySelector("#unity-container");
        const canvas = document.querySelector("#unity-canvas");
        const loadingCover = document.querySelector("#loading-cover");
        const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
        const progressBarFull = document.querySelector("#unity-progress-bar-full");

        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            container.className = "unity-mobile";
        }
        
        loadingCover.style.display = "";

        const unityLoader = document.createElement("script");
        unityLoader.src = loaderUrl;
        unityLoader.onload = () => {
            createUnityInstance(canvas, config, (progress) => {
                progressBarEmpty.style.display = "";
                progressBarFull.style.width = \`\${100 * progress}%\`;
            }).then((unityInstance) => {
                window.unityInstance = unityInstance;
                loadingCover.style.display = "none";
            }).catch((message) => {
                alert(message);
            });
        };
        document.body.appendChild(unityLoader);

        document.addEventListener("pointerdown", () => {
            container.focus();
            window.focus();
            canvas.focus();
        });
    <\/script>
</body>
</html>
            `;
            
            iframe.srcdoc = gameHTML;
            overlay.classList.add('active');
        }

        function closeRagdollArchers() {
            document.getElementById('archers-overlay').classList.remove('active');
            document.getElementById('archers-frame').srcdoc = '';
        }

        function openFlightSim() {
            const overlay = document.getElementById('flight-overlay');
            const iframe = document.getElementById('flight-frame');
            
            const gameHTML = `
<!DOCTYPE html>
<html lang="en-us">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NMNKZYDPP8"><\/script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NMNKZYDPP8');
    <\/script>
    <meta charset="utf-8">
    <base href="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@main/flight%20sim/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | Flight Simulator</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="Build/UnityLoader.js"><\/script>
    <script>
        function mergeFiles(fileParts) {
          return new Promise((resolve, reject) => {
            let buffers = [];
            function fetchPart(i) {
              if (i >= fileParts.length) {
                let mergedBlob = new Blob(buffers);
                resolve(mergedBlob);
                return;
              }
              fetch(fileParts[i])
                .then(r => r.arrayBuffer())
                .then(data => {
                  buffers.push(data);
                  fetchPart(i + 1);
                })
                .catch(reject);
            }
            fetchPart(0);
          });
        }

        function getParts(file, start, end) {
          let arr = [];
          for (let i = start; i <= end; i++) {
            arr.push(file + ".part" + i);
          }
          return arr;
        }

        function resizeUnityContainer() {
          var container = document.getElementById("gameContainer");
          if (container) {
            container.style.width = window.innerWidth + "px";
            container.style.height = window.innerHeight + "px";
          }
        }

        window.addEventListener('resize', resizeUnityContainer);

        function UnityProgress(gameInstance, progress) {
          try {
            if (progress === 'complete') {
              return;
            }
            var pct = 0;
            if (typeof progress === 'number') pct = progress;
            else if (progress && progress.total && progress.loaded) pct = progress.loaded / progress.total;
            var txt = document.getElementById('loading-text');
            if (txt) txt.textContent = 'Loading... ' + Math.round(pct * 100) + '%';
          } catch (e) {
            console.error('Progress error:', e);
          }
        }

        window.addEventListener("load", function () {
          window.unityMergedFiles = {};
          
          Promise.all([
            mergeFiles(getParts("Build/game.data.unityweb", 1, 2)),
            mergeFiles(getParts("Build/game.asm.code.unityweb", 1, 1)), 
            mergeFiles(getParts("Build/game.asm.memory.unityweb", 1, 1)),
            mergeFiles(getParts("Build/game.asm.framework.unityweb", 1, 1))
          ]).then(([dataBlob, wasmCodeBlob, wasmMemoryBlob, wasmFrameworkBlob]) => {
            window.unityMergedFiles['Build/game.data.unityweb'] = URL.createObjectURL(dataBlob);
            window.unityMergedFiles['Build/game.asm.code.unityweb'] = URL.createObjectURL(wasmCodeBlob);
            window.unityMergedFiles['Build/game.asm.memory.unityweb'] = URL.createObjectURL(wasmMemoryBlob);
            window.unityMergedFiles['Build/game.asm.framework.unityweb'] = URL.createObjectURL(wasmFrameworkBlob);
            
            console.log("Merged files ready:", Object.keys(window.unityMergedFiles));
            
            const originalFetch = window.fetch;
            window.fetch = function(url, ...args) {
              if (typeof url === 'string' && window.unityMergedFiles[url]) {
                console.log("Redirecting fetch to merged file:", url);
                return originalFetch(window.unityMergedFiles[url], ...args);
              }
              return originalFetch(url, ...args);
            };
            
            const OriginalXHR = window.XMLHttpRequest;
            window.XMLHttpRequest = function() {
              const xhr = new OriginalXHR();
              const originalOpen = xhr.open;
              
              xhr.open = function(method, url, ...args) {
                if (typeof url === 'string' && window.unityMergedFiles[url]) {
                  console.log("Redirecting XHR to merged file:", url);
                  return originalOpen.call(this, method, window.unityMergedFiles[url], ...args);
                }
                return originalOpen.call(this, method, url, ...args);
              };
              
              return xhr;
            };
            
            window.gameInstance = UnityLoader.instantiate("gameContainer", "Build/game.json", {
              onProgress: UnityProgress,
              Module: {
                onRuntimeInitialized: function () {
                  resizeUnityContainer();
                  let loadingText = document.querySelector("#loading-text");
                  if (loadingText) loadingText.remove();
                  UnityProgress(window.gameInstance, 'complete');
                }
              }
            });
          })
          .catch(err => {
            console.error("Unity load failed:", err);
            let txt = document.getElementById('loading-text');
            if (txt) txt.textContent = 'Loading failed: ' + err.message;
          });
        });
    <\/script>
</head>
<body>
    <div class="webgl-content">
        <div id="gameContainer" style="width: 960px; height: 600px">
            <p id="loading-text">Loading...</p>
        </div>
        <div class="footer">
            <div class="webgl-logo"></div>
            <div class="fullscreen" onclick="window.gameInstance && window.gameInstance.SetFullscreen(1)"></div>
        </div>
    </div>
</body>
</html>
            `;
            
            iframe.srcdoc = gameHTML;
            overlay.classList.add('active');
        }

        function closeFlightSim() {
            document.getElementById('flight-overlay').classList.remove('active');
            document.getElementById('flight-frame').srcdoc = '';
        }

        async function loadAndMergeZipParts() {
            const PARTS_FOLDER = 'https://cdn.jsdelivr.net/gh/bubbls/dosbox/softs/fallout/';  
            const BASE_FILENAME = 'fallout.zip';   
            const NUM_PARTS = 23;

            const progressEl = document.getElementById('fallout-progress');
            const loadingEl = document.getElementById('fallout-loading');
            
            try {
                const chunks = [];
                
                for (let i = 1; i <= NUM_PARTS; i++) {
                    progressEl.textContent = `Loading part ${i}/${NUM_PARTS}...`;
                    
                    const partNum = i.toString().padStart(2, '0');
                    const partUrl = `${PARTS_FOLDER}${BASE_FILENAME}.part${partNum}`;
                    const response = await fetch(partUrl);
                    
                    if (!response.ok) {
                        throw new Error(`Failed to load ${partUrl}: ${response.status}`);
                    }
                    
                    const arrayBuffer = await response.arrayBuffer();
                    chunks.push(arrayBuffer);
                    
                    const progress = Math.round((i / NUM_PARTS) * 100);
                    progressEl.textContent = `Merging archive parts: ${progress}%`;
                }
                
                progressEl.textContent = 'Merging complete! Starting emulator...';
                const mergedBlob = new Blob(chunks, { type: 'application/zip' });
                const blobUrl = URL.createObjectURL(mergedBlob);
                
                loadingEl.style.display = 'none';
                document.getElementById('fallout-canvas').style.display = 'block';
                
                startEmulator(blobUrl);
                
            } catch (error) {
                progressEl.textContent = `Error: ${error.message}`;
                console.error('Failed to load game:', error);
            }
        }

        function startEmulator(zipUrl) {
            var dosbox = new Emulator(document.querySelector("#fallout-canvas"),
                null,
                new DosBoxLoader(DosBoxLoader.emulatorJS("https://cdn.jsdelivr.net/gh/bubbls/dosbox/js/dosbox-sync.js"),
                    DosBoxLoader.locateAdditionalEmulatorJS(locateAdditionalFiles),
                    DosBoxLoader.nativeResolution(640, 400),
                    DosBoxLoader.mountZip("c",
                        DosBoxLoader.fetchFile("Software", zipUrl)),
                    DosBoxLoader.startExe('FALLOUT/FALLOUT.EXE')));
            dosbox.start({
                waitAfterDownloading: false
            });

            function locateAdditionalFiles(filename) {
                if (filename === "dosbox.html.mem") {
                    return "https://cdn.jsdelivr.net/gh/bubbls/dosbox/js/dosbox-sync.mem";
                }
                return "https://cdn.jsdelivr.net/gh/bubbls/dosbox/js/" + filename;
            }
        }
    </script>
</body>
</html>
